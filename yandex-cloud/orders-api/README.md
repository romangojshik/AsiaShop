# orders-api — приём заказов (YDB + Telegram)

HTTP Cloud Function: принимает POST с JSON заказа, сохраняет в YDB в таблицу `order` и отправляет уведомление в Telegram.

## Переменные окружения

| Переменная | Описание |
|------------|----------|
| YDB_ENDPOINT | Эндпоинт YDB (например `ydb.serverless.yandexcloud.net:2135`) |
| YDB_DATABASE | Путь к базе (например `/ru-central1/…/etn…`) |
| TELEGRAM_BOT_TOKEN | Токен бота (получить у [@BotFather](https://t.me/BotFather)) |
| TELEGRAM_CHAT_ID | ID чата/группы (например `-5016693415` для группы) |

**Важно:** не храни токен в коде. Задавай только в настройках функции в консоли Yandex Cloud.

## Таблица в YDB

Должна существовать таблица `order` (скрипт в `../ydb-scripts/create-order-table.yql`). Выполни его в своей базе перед первым вызовом.

## Формат запроса (POST)

Тело запроса — JSON в формате, как раньше в Firebase:

```json
{
  "id": "UUID-заказа",
  "userName": "Имя",
  "numberPhone": "79991234567",
  "status": "Новый",
  "total": 500.50,
  "createdAt": "2026-02-20T12:00:00.000Z",
  "readyBy": "2026-02-20T14:00:00.000Z",
  "positions": [
    {
      "id": "uuid-позиции",
      "count": 2,
      "cost": 250.25,
      "product": {
        "id": "...",
        "title": "Название",
        "imageURL": "...",
        "price": 125.12,
        "description": "...",
        "weight": "400",
        "callories": "500",
        "protein": "10",
        "fats": "20"
      }
    }
  ]
}
```

Поля `createdAt`, `readyBy` можно передавать как ISO-строку или как число (миллисекунды). `readyBy` необязателен.

## Ответ

- **200:** `{ "ok": true, "id": "…" }` — заказ сохранён, в Telegram отправлено (если заданы токен и chat_id).
- **400:** неверный JSON или нет обязательных полей.
- **500:** ошибка записи в YDB.

## Деплой

1. В консоли Cloud Functions создай функцию (или используй существующую), укажи переменные окружения.
2. Сервисному аккаунту функции выдай права на YDB (например, `ydb.editor`) и доступ в интернет для Telegram API.
3. Собери ZIP: `index.js` + `package.json` (зависимости можно ставить при деплое). Загрузи в функцию.
4. Создай триггер HTTP с путём (или подключи к API Gateway) и скопируй URL — его нужно указать в приложении как URL API заказов.
